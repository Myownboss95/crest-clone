import{o as V,M as j,z as $,a as c,b as i,e as t,t as v,n as E,p as P,A as q,B as M,i as C,s as T,r as D,d as o,w as p,j as w,h as y,u as r,m as b,F,g as H}from"./main.a4388b13.js";import{b as R}from"./breadcrumb.af1b015e.js";import{_ as L}from"./FormGroup.4594be7e.js";import{_ as f}from"./FormButton.1c8871a2.js";import{_ as h}from"./ButtonLoader.399048fd.js";import"./FormLabel.115ae360.js";import"./FormInput.7b1a5695.js";import"./error.e7db4921.js";const N=["id"],O={class:"modal-content"},I={class:"modal-header"},U={class:"modal-title"},A={name:"modal",props:{open:{type:Boolean,default:!1},title:{type:String,default:""},id:{type:String,default:"myModal"},size:{type:String,default:""}},emits:["modealClosed"],setup(m,{emit:_}){const a=m;let d=null;V(()=>{d=new j(document.getElementById(a.id,{backdrop:"static",keyboard:!1}))}),$(()=>a.open,n=>{d.show()});const l=()=>{d.hide(),_("modealClosed")};return(n,g)=>(c(),i("div",{class:"modal fade bs-example-modal-center",tabindex:"-1","aria-hidden":"true",id:a.id,"data-bs-backdrop":"static","data-bs-keyboard":"false"},[t("div",{class:P(["modal-dialog modal-dialog-centered",a.size!=""?`modal-${a.size}`:""])},[t("div",O,[t("div",I,[t("h5",U,v(a.title),1),t("button",{type:"button",class:"btn-close",onClick:l})]),E(n.$slots,"default")])],2)],8,N))}},x=m=>{navigator.clipboard.writeText(m).then(_=>q("Copied to clipboard"),_=>M("Copy to clipboard failed."))};const G={class:"col-lg-4 col-md-4 m-auto mt-5"},J={class:"card shadow"},K={class:"card-body"},Q={class:"d-flex justify-content-center align-items-center",style:{"min-height":"300px"}},W={key:0,class:"text-center"},X=t("p",null," Two factor authentication is enabled. ",-1),Y={key:1},Z={class:"text-center"},tt=t("p",null," To enable two factor authentication, click on the button below to get started on the process. ",-1),ot=["onSubmit"],et={key:1},st={class:"text-center px-3 py-2"},at=t("p",null," Download the google authenticator app from App Store or Play store, scan the qr code below ",-1),nt={class:"d-flex justify-content-center py-3"},lt=["innerHTML"],rt={class:"text-justify"},ct=y(" Alternatively you can use "),it=y(" as a setup key to create a secure link from authenticator to your account. "),dt=t("p",null,"Copy your recovery codes and store them securely as they can be used to disable Two Factor Authentication.",-1),ut={class:"text-center"},pt=t("p",null," After set up click on the confirm status button below to enter code from the authenticator app to verify the setup. ",-1),_t={class:""},mt={class:"modal-body"},ft={class:"list-group"},ht={class:"copy"},bt=["onClick"],yt=t("i",{class:"fa fa-copy"},null,-1),wt=y(" copy "),vt=[yt,wt],gt={class:"modal-body"},kt=["onSubmit"],Ct=t("p",{class:"text-center"},"Enter the TOTP from the google authenticator app and click the confirm button",-1),Vt={name:"two-factor-auth",props:["auth","errors"],setup(m){const _=m,a=C(),d=C({code:""});$(()=>_.errors,s=>{"confirmTwoFactorAuthentication"in s&&M(s.confirmTwoFactorAuthentication.code)});let l=T(!1),n=T(!1);const g=()=>{a.post(route("two-factor.enable"))},S=()=>{a.delete(route("two-factor.disable"))},k=()=>{d.post(route("two-factor.confirm"),{onSuccess:()=>{document.querySelectorAll(".btn-close").forEach(s=>{s.click()})}})};return(s,e)=>{const B=D("Head");return c(),i(F,null,[o(B,{title:"Two Factor Auth"}),o(R,{title:"Two Factor Auth",crumbs:["Dashboard","Two Factor Auth"]}),t("div",G,[t("div",J,[t("div",K,[t("div",Q,[s.$page.props.auth.user.two_factor_status?(c(),i("div",W,[X,o(f,{class:"btn btn-outline-danger",onButtonClicked:S},{default:p(()=>[o(h,{text:"Disable Two Factor Auth",loading:r(a).processing},null,8,["loading"])]),_:1})])):(c(),i("div",Y,[s.$page.props.auth.user.two_factor_auth_status===!1?(c(),i("form",{key:0,onSubmit:e[0]||(e[0]=w((...u)=>s.changePassword&&s.changePassword(...u),["prevent"]))},[t("div",Z,[tt,t("form",{onSubmit:w(g,["prevent"])},[o(f,{class:"btn btn-outline-primary",type:"submit"},{default:p(()=>[o(h,{text:"Enable Two Factor Auth",loading:r(a).processing},null,8,["loading"])]),_:1})],40,ot)])],32)):(c(),i("form",et,[t("div",st,[at,t("div",nt,[t("div",{class:"text-center mb-3 p-2 bg-white",innerHTML:s.$page.props.auth.user.two_factor_qr_code_svg},null,8,lt)]),t("div",rt,[t("p",null,[ct,t("strong",null,[y(v(s.$page.props.auth.user.two_factor_recovery_codes[0])+" ",1),t("i",{class:"fa fa-copy cursor-pointer",onClick:e[1]||(e[1]=u=>r(x)(s.$page.props.auth.user.two_factor_recovery_codes[0]))})]),it]),dt,t("div",ut,[o(f,{class:"btn btn-outline-success mb-3",onButtonClicked:e[2]||(e[2]=()=>b(l)?l.value=!0:l=!0)},{default:p(()=>[o(h,{text:"Recovery Codes"})]),_:1})]),pt]),t("div",_t,[o(f,{class:"btn btn-outline-info mr-auto",onButtonClicked:e[3]||(e[3]=()=>b(n)?n.value=!0:n=!0)},{default:p(()=>[o(h,{text:"Confirm 2FA Status"})]),_:1})])])]))]))])])]),o(A,{title:"Recovery codes",id:"recoveryCodesModal",open:r(l),onModealClosed:e[4]||(e[4]=()=>{b(l)?l.value=!1:l=!1})},{default:p(()=>[t("div",mt,[t("ol",ft,[(c(!0),i(F,null,H(_.auth.user.two_factor_recovery_codes,(u,z)=>(c(),i("li",{class:"list-group-item d-flex justify-content-between",key:z},[t("span",ht,v(u),1),t("span",{class:"text-info",onClick:Tt=>r(x)(u)},vt,8,bt)]))),128))])])]),_:1},8,["open"]),o(A,{id:"ConfirmTwoFactorModal",size:"sm",title:"Confirm two factor auth",open:r(n),onModealClosed:e[6]||(e[6]=()=>b(n)?n.value=!1:n=!1)},{default:p(()=>[t("div",gt,[t("form",{class:"pb-3",onSubmit:w(k,["prevent"])},[Ct,o(L,{placeholder:"TOTP code",modelValue:r(d).code,"onUpdate:modelValue":e[5]||(e[5]=u=>r(d).code=u)},null,8,["modelValue"]),o(f,{class:"btn btn-outline-success w-100",type:"submit"},{default:p(()=>[o(h,{text:"Confirm",loading:k.processing},null,8,["loading"])]),_:1})],40,kt)])]),_:1},8,["open"])])],64)}}};export{Vt as default};
